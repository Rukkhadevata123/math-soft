# main.c 代码说明

这个程序是用来生成一系列的 Mandelbrot 分形图像，并将它们保存为 BMP 格式的文件。

## 代码结构

代码主要由以下几个部分组成：

1. **main 函数**：这个函数首先检查命令行参数的数量，如果参数数量不正确，它会打印出正确的使用方法并退出。然后，它从命令行参数中获取图像的宽度、高度和图像数量。接着，它定义了一些用于生成 Mandelbrot 分形的参数，如放大因子和视图中心。之后，它进入一个循环，每次循环都会生成一个新的图像。在每次循环中，它首先定义了位图文件头和信息头，然后分配了一块内存来存储图像数据。接着，它遍历每个像素，计算出该像素对应的复数，并调用 `mandelbrot` 函数来计算该复数在 Mandelbrot 集合中的迭代次数。然后，它使用 `color_map` 函数将迭代次数映射为一个颜色，并将该颜色存储在图像数据中。最后，它打开一个新的文件，将位图文件头、信息头和图像数据写入文件，然后关闭文件并释放图像数据的内存。

2. **mandelbrot 函数**：这个函数接受一个复数（由实部和虚部表示）作为参数，然后计算该复数在 Mandelbrot 集合中的迭代次数。它首先定义了最大迭代次数和两个变量 r 和 i 来存储复数的实部和虚部。然后，它进入一个循环，每次循环都会更新 r 和 i 的值，并检查 r*r + i*i 是否小于或等于 4.0。如果是，那么该复数可能在 Mandelbrot 集合中，否则该复数不在 Mandelbrot 集合中。循环结束后，如果 n 等于最大迭代次数，那么该复数在 Mandelbrot 集合中，函数返回 0。否则，函数使用平滑颜色算法计算颜色值，并返回该值。

3. **color_map 函数**：这个函数接受一个值和一个 RGBTRIPLE 指针作为参数。如果值为 0，那么它将颜色设置为黑色。否则，它使用该值来计算颜色的红色、绿色和蓝色分量，并将这些分量存储在 RGBTRIPLE 结构中。

## Makefile 说明

Makefile 是一个用来自动化编译和链接的工具，它使用一种称为 make 的语言来描述如何构建程序。

在这个 Makefile 中，定义了以下几个目标：

1. **all**：这是默认目标，它依赖于 `main`、`input.png` 和 `output.mp4` 这三个目标。当你运行 `make` 命令时，它会尝试构建这三个目标。

2. **main**：这个目标依赖于 `main.o` 和 `fractal.o` 这两个目标。当这两个目标都被构建后，它会运行链接命令来生成 `main` 可执行文件。

3. **%.o**：这是一个模式规则，它匹配任何 `.o` 文件。当一个 `.o` 文件被构建时，它会运行编译命令来生成该 `.o` 文件。

4. **input.png**：这个目标依赖于 `main` 目标。当 `main` 目标被构建后，它会运行 `main` 可执行文件来生成一系列的 `.bmp` 文件，然后使用 `convert` 命令将这些 `.bmp` 文件转换为 `.png` 文件。

5. **output.mp4**：这个目标依赖于 `input.png` 目标。当 `input.png` 目标被构建后，它会运行 `ffmpeg` 命令将这些 `.png` 文件转换为一个 `.mp4` 文件。

6. **clean**：这个目标没有依赖，当你运行 `make clean` 命令时，它会删除所有生成的文件。

## 编译和运行

你可以使用以下命令来编译和运行这个程序：

```bash
make
```

运行成功后，你会在当前目录下看到一系列的 .bmp、.png 文件和一个 output.mp4 文件。
